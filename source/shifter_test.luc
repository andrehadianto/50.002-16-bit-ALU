module shifter_test (
    input clk,  // clock
    input rst,  // reset
    input trigger,
    
    output io_led [3][8],   // LEDs on IO Shield
    output io_seg [8],      // 7-segment LEDs on IO Shield
    output io_sel [4]       // Digit select on IO Shield
  ) {
  shifter shifter;
  
  .clk(clk){
    .rst(rst){
      fsm shifter_test = {IDLE,TEST1,TEST2,TEST3,TEST4,TEST5,TEST6,TEST7,TEST8,TEST9,FAIL,PASS};
      multi_seven_seg seg;
      statecounter statectr;
    }
  }
  always {
    shifter.a = 0;
    shifter.b = 0;
    shifter.alufn = 6b0;
    io_seg = 8hff;          // turn segments off
    io_led = 3x{{8h00}};    // turn LEDs off

    seg.values = {4h0,4h0,4h0,4h0}; 
    io_seg = ~seg.seg; // Connect segments to the driver
    io_sel = ~seg.sel; // Connect digit select to the driver
    
    case(shifter_test.q){
      shifter_test.IDLE:
        seg.values = {4h8,4h4,4h9,4h5};
        if (trigger == 1){
          shifter_test.d = shifter_test.TEST1;
        }    
      shifter_test.TEST1:
        shifter.a = 16b01010101010101;
        shifter.b = 16b1;
        shifter.alufn = 6b100000;
        seg.values = shifter.segv;
        if (shifter.shift == 16b10101010101010 & statectr.msb == 1){
          shifter_test.d = shifter_test.TEST2;
        }
        else if (statectr.msb == 1){
          shifter_test.d = shifter_test.FAIL;
        }
      shifter_test.TEST2:
        shifter.a = 16b1001010101000101;
        shifter.b = 16b1111;
        shifter.alufn = 6b100000;
        seg.values = shifter.segv;
        if (shifter.shift == 16b1000000000000000 & statectr.msb == 1){
          shifter_test.d = shifter_test.TEST3;
        }
        else if (statectr.msb == 1){
          shifter_test.d = shifter_test.FAIL;
        }
      shifter_test.TEST3:
        shifter.a = 16b1111000011100000;
        shifter.b = 16b0000111100100101;
        shifter.alufn = 6b100000;
        seg.values = shifter.segv;
        if (shifter.shift == 16b0001110000000000 & statectr.msb == 1){
          shifter_test.d = shifter_test.TEST4;
        }
        else if (statectr.msb == 1){
          shifter_test.d = shifter_test.FAIL;
        }
      shifter_test.TEST4:
        shifter.a = 16b01010101010101;
        shifter.b = 16b1;
        shifter.alufn = 6b100001;
        seg.values = shifter.segv;
        if (shifter.shift == 16b00101010101010 & statectr.msb == 1){
          shifter_test.d = shifter_test.TEST5;
        }
        else if (statectr.msb == 1){
          shifter_test.d = shifter_test.FAIL;
        }
      shifter_test.TEST5:
        shifter.a = 16b1001010101000101;
        shifter.b = 16b1111;
        shifter.alufn = 6b100001;
        seg.values = shifter.segv;
        if (shifter.shift == 16b0000000000000001 & statectr.msb == 1){
          shifter_test.d = shifter_test.TEST6;
        }
        else if (statectr.msb == 1){
          shifter_test.d = shifter_test.FAIL;
        }
      shifter_test.TEST6:
        shifter.a = 16b1111000011100000;
        shifter.b = 16b0000111100100101;
        shifter.alufn = 6b100001;
        seg.values = shifter.segv;
        if (shifter.shift == 16b0000011110000111 & statectr.msb == 1){
          shifter_test.d = shifter_test.TEST7;
        }
        else if (statectr.msb == 1){
          shifter_test.d = shifter_test.FAIL;
        }
      shifter_test.TEST7:
        shifter.a = 16b0001010101010101;
        shifter.b = 16b1;
        shifter.alufn = 6b100011;
        seg.values = shifter.segv;
        if (shifter.shift == 16b00101010101010 & statectr.msb == 1){
          shifter_test.d = shifter_test.TEST8;
        }
        else if (statectr.msb == 1){
          shifter_test.d = shifter_test.FAIL;
        }
      shifter_test.TEST8:
        shifter.a = 16b1001010101000101;
        shifter.b = 16b1111;
        shifter.alufn = 6b100011;
        seg.values = shifter.segv;
        if (shifter.shift == 16b1111111111111111 & statectr.msb == 1){
          shifter_test.d = shifter_test.TEST9;
        }
        else if (statectr.msb == 1){
          shifter_test.d = shifter_test.FAIL;
        }
      shifter_test.TEST9:
        shifter.a = 16b1111000011100000;
        shifter.b = 16b0000111100100101;
        shifter.alufn = 6b100011;
        seg.values = shifter.segv;
        if (shifter.shift == 16b1111111110000111 & statectr.msb == 1){
          shifter_test.d = shifter_test.PASS;
        }
        else if (statectr.msb == 1){
          shifter_test.d = shifter_test.FAIL;
        }
      shifter_test.PASS:
        seg.values = {4hC,4h1,4hE,4hE};
        
      shifter_test.FAIL:
        seg.values = {4h6,4h1,4h8,4h9};
    }
  }
}
