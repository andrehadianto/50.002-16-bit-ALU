module adder_test (
    input clk,  // clock
    input rst,  // reset
    input trigger,
    
    output io_led [3][8],   // LEDs on IO Shield
    output io_seg [8],      // 7-segment LEDs on IO Shield
    output io_sel [4]       // Digit select on IO Shield
  ) {
  adder adder;
  
  .clk(clk){
    .rst(rst){
      fsm adder_test = {IDLE,TEST1,TEST2,TEST3,TEST4,TEST5,TEST6,TEST7,TEST8,TEST9,FAIL,PASS};
      multi_seven_seg seg;
      statecounter statectr;
    }
  }
  always {
    adder.a = 0;
    adder.b = 0;
    adder.alufn = 6b0;
    io_seg = 8hff;          // turn segments off
    io_led = 3x{{8h00}};    // turn LEDs off

    seg.values = 4x{{8h0}}; 
    io_seg = ~seg.seg; // Connect segments to the driver
    io_sel = ~seg.sel; // Connect digit select to the driver
    
    case(adder_test.q){
      adder_test.IDLE: //IDLE
        seg.values = {8h8,8h4,8h9,8h5};
        if (trigger == 1){
          adder_test.d = adder_test.TEST1;
        }    
      adder_test.TEST1:
        seg.values = {8h1,8h4,8h4,8h11};
        
        adder.a = 16b0001010101010101;
        adder.b = 16b0010101010101011;
        adder.alufn = 6b0;
        seg.values = adder.segv;
        if (adder.adder == 16b0100000000000000 & statectr.msb == 1){
          adder_test.d = adder_test.TEST2;
        }
        else if (statectr.msb == 1){
          adder_test.d = adder_test.FAIL;
        }
      adder_test.TEST2:
        seg.values = {8h1,8h4,8h4,8h12};
        
        adder.a = 16b1001010101000101;
        adder.b = 16b0001111010101111;
        adder.alufn = 6b0;
        seg.values = adder.segv;
        if (adder.adder == 16b01011001111110100 & statectr.msb == 1){
          adder_test.d = adder_test.TEST3;
        }
        else if (statectr.msb == 1){
          adder_test.d = adder_test.FAIL;
        }
      adder_test.TEST3:
        seg.values = {8h1,8h4,8h4,8h13};
        
        adder.a = 16b1111000011100000;
        adder.b = 16b0000111100100000;
        adder.alufn = 6b0;
        seg.values = adder.segv;
        if (adder.adder == 16b1000000000000000 & statectr.msb == 1){
          adder_test.d = adder_test.TEST4;
        }
        else if (statectr.msb == 1){
          adder_test.d = adder_test.FAIL;
        }
      adder_test.TEST4:
        seg.values = {8h15,8hF,8h2,8h11};
        
        adder.a = 16b1111000011100000;
        adder.b = 16b0000000000100000;
        adder.alufn = 6b1;
        seg.values = adder.segv;
        if (adder.adder == 16b1111000011000000 & statectr.msb == 1){
          adder_test.d = adder_test.TEST5;
        }
        else if (statectr.msb == 1){
          adder_test.d = adder_test.FAIL;
        }
      adder_test.TEST5:
        seg.values = {8h15,8hF,8h2,8h12};
        
        adder.a = 16b0001111001111111;
        adder.b = 16b0000010101010101;
        adder.alufn = 6b1;
        seg.values = adder.segv;
        if (adder.adder == 16b01100100101010 & statectr.msb == 1){
          adder_test.d = adder_test.TEST6;
        }
        else if (statectr.msb == 1){
          adder_test.d = adder_test.FAIL;
        }
      adder_test.TEST6:
        seg.values = {8h15,8hF,8h2,8h13};
        
        adder.a = 16b1000000000000000;
        adder.b = 16b0000000000000001;
        adder.alufn = 6b1;
        seg.values = adder.segv;
        if (adder.adder == 16b01111111111111111 & statectr.msb == 1){
          adder_test.d = adder_test.TEST7;
        }
        else if (statectr.msb == 1){
          adder_test.d = adder_test.FAIL;
        }
      adder_test.TEST7:
        seg.values = {8hA,8hF,8h9,8h11};
        
        adder.a = 16b0;
        adder.b = 16b0000000000000001;
        adder.alufn = 6b10;
        seg.values = adder.segv;
        if (adder.adder == 16b0 & statectr.msb == 1){
          adder_test.d = adder_test.TEST8;
        }
        else if (statectr.msb == 1){
          adder_test.d = adder_test.FAIL;
        }
      adder_test.TEST8:
        seg.values = {8hA,8hF,8h9,8h12};
        
        adder.a = 16b0000000000000010;
        adder.b = 16b0000000000001001;
        adder.alufn = 6b10;
        seg.values = adder.segv;
        if (adder.adder == 16b10010 & statectr.msb == 1){
          adder_test.d = adder_test.TEST9;
        }
        else if (statectr.msb == 1){
          adder_test.d = adder_test.FAIL;
        }
      adder_test.TEST9:
        seg.values = {8hA,8hF,8h9,8h13};
        
        adder.a = 16b111000000;
        adder.b = 16b000000111;
        adder.alufn = 6b10;
        seg.values = adder.segv;
        if (adder.adder == 16b0110001000000 & statectr.msb == 1){
          adder_test.d = adder_test.PASS;
        }
        else if (statectr.msb == 1){
          adder_test.d = adder_test.FAIL;
        }
      adder_test.PASS:
        seg.values = {8hC,8h1,8h15,8h15};
        
      adder_test.FAIL:
        seg.values = {8h6,8h1,8h8,8h9};
    }
  }
}
